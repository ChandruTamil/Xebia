angular.module("todomvc").factory("todoStorage",function(o,t){"use strict";return o.get("/api").then(function(){return t.get("api")},function(){return t.get("localStorage")})}).factory("api",function(o){"use strict";var t={todos:[],api:o("/api/todos/:id",null,{update:{method:"PUT"}}),clearCompleted:function(){var o=t.todos.slice(0),e=t.todos.filter(function(o){return!o.completed});return angular.copy(e,t.todos),t.api.delete(function(){},function(){angular.copy(o,t.todos)})},delete:function(o){var e=t.todos.slice(0);return t.todos.splice(t.todos.indexOf(o),1),t.api.delete({id:o.id},function(){},function(){angular.copy(e,t.todos)})},get:function(){return t.api.query(function(o){angular.copy(o,t.todos)})},insert:function(o){var e=t.todos.slice(0);return t.api.save(o,function(e){o.id=e.id,t.todos.push(o)},function(){angular.copy(e,t.todos)}).$promise},put:function(o){return t.api.update({id:o.id},o).$promise}};return t}).factory("localStorage",function(o){"use strict";var t={todos:[],_getFromLocalStorage:function(){return JSON.parse(localStorage.getItem("todos-angularjs")||"[]")},_saveToLocalStorage:function(o){localStorage.setItem("todos-angularjs",JSON.stringify(o))},clearCompleted:function(){var e=o.defer(),r=t.todos.filter(function(o){return!o.completed});return angular.copy(r,t.todos),t._saveToLocalStorage(t.todos),e.resolve(t.todos),e.promise},delete:function(e){var r=o.defer();return t.todos.splice(t.todos.indexOf(e),1),t._saveToLocalStorage(t.todos),r.resolve(t.todos),r.promise},get:function(){var e=o.defer();return angular.copy(t._getFromLocalStorage(),t.todos),e.resolve(t.todos),e.promise},insert:function(e){var r=o.defer();return t.todos.push(e),t._saveToLocalStorage(t.todos),r.resolve(t.todos),r.promise},put:function(e,r){var n=o.defer();return t.todos[r]=e,t._saveToLocalStorage(t.todos),n.resolve(t.todos),n.promise}};return t});